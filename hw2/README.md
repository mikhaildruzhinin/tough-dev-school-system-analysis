# Домашняя работа №2

## Поддомены

Из общего ТЗ я выписал все подразделения, которые упоминались в US:

1) исполнители
2) отдел сборки расходников
3) отдел изучения качества работы
4) отдел rnd
5) отдел работы с исполнителями

Для каждого подразделения выбрал проблему, которую оно решает: 

1) исполнение заказов
2) сборка расходников для заказов
3) изучение качества работы
4) матчинг воркера под услугу (тут смущает, что отдел занимается разработкой методологии матчинга, а не руками выбирает, кому что делать)
5) привлечение новых исполнителей
6) повышение мотивации менеджеров

Расширение на аудиторию помимо тестировщиков Happy Cat Box только планируется, поэтому привлечение новых клиентов я не рассматривал как поддомен.
Повышение мотивации как отдельный поддомен я добавил позднее, потому что их контекст не ложился ни в один из ранее сформированных поддоменов.

Выписал в таблицу для каждого поддомена значения характеристик, ниже даны комментарии.

| Название поддомена             | Конкурентное преимущество | Сложность доменной модели | Изменчивость | Варианты реализации | Интерес проблемы | Предполагаемый вид поддомена |
| ------------------------------ | ------------------------- | ------------------------- | ------------ | ------------------- | ---------------- | ---------------------------- |
| исполнение заказов             | да                        | высокая                   | частая       | инхаус              | -                | core                         |
| сборка расходников для заказов | нет                       | низкая                    | редкая       | инхаус              | -                | generic                      |
| изучение качества работы       | нет                       | низкая                    | редкая       | инхаус              | -                | supporting                   |
| матчинг воркера под услугу     | да                        | низкая                    | частая       | инхаус              | -                | supporting                   |
| привлечение новых исполнителей | да                        | низкая                    | редкая       | инхаус              | -                | supporting                   |
| повышение мотивации менеджеров | нет                       | низкая                    | редкая       | инхаус              | -                | supporting                   |

Исполнение заказов является конкурентным преимуществом, т.к. является основным видом деятельности для компании.
Подбор исполнителей -- в общем тз указано, что компания планирует нанимать 3% лучших исполнителей.
Также в тз есть информация про инновационный матчинг, поэтому я добавил его тоже в список конкурентных преимуществ.

Бизнесовая сложность поддомена исполнения заказов будет высокой, т.к. в этом поддомене присутствует большое количество бизнес-процессов и сущностей.
Сложность остальных поддоменов принимаем как низкую.
Для поддомена матчинга сложность является низкой только на текущий момент, т.к. алгоритм системы матчинга ещё не был разработан.
сложность домена.

Изменчивость системы я оценивал по US из общего тз, изменчивыми считаю те поддомены, про которые было написано "сейчас сделаем так, а потом поменяем".
Также я принял допущение, что вся разработка будет вестись инхаус с нуля, не будет использовано готовых решений или услуг аутсорс-компаний.
Интерес при решении проблемы я принял решение не учитывать.

После заполнения таблицы я перенёс все поддомены на core domain chart.
Диаграмма доступна по [ссылке](core-domain-chart/core-domain-chart.drawio.png).
Отдельно хочу обратить внимание, что на диаграмме выделено текущее расположение поддомена матчинга, а также его движение в перспективе, после того, как будет разработана более сложная система матчинга.

## Изолированные контексты

У меня в итоге так и не сложилось понимание, что есть бизнес проблема, а что -- решение.
Сделал в итоге как смог, буду продолжать разбираться потом.

| бизнес проблема (поддомен)     | вид поддомена | решение (изолированный контекст)         |
| ------------------------------ | ------------- | ---------------------------------------- |
| исполнение заказов             | core          | система исполнения заказов               |
| исполнение заказов             | core          | списание средств у пользователей         |
| исполнение заказов             | core          | начисление средств исполнителям          |
| исполнение заказов             | core          | добавление новых клиентов                |
| сборка расходников для заказов | generic       | система сборки расходников               |
| изучение качества работы       | supporting    | разработка гипотез для улучшения бизнеса |
| матчинг воркера под услугу     | supporting    | алгоритм матчинга                        |
| привлечение новых исполнителей | supporting    | устройство новых исполнителей в штат     |
| повышение мотивации менеджеров | supporting    | система ставок                           |

Диаграмма с выделенными поддоменами и изолированными контекстами доступна по [ссылке](bounded-contexts/bounded-contexts.drawio.png)

## Различия с прошлой реализацией ES

В отличие от прошлой реализации Event Storming я добавил новый изолированный контекст для матчинга исполнителей и задач.
Этот контекст выделен, потому что согласно тз есть команда, которая занимается разработкой алгоритма матчинга имеет свою отдельную терминлогию и доменных экспертов.

Также контекст по обработке платежей я разбил на два отдельных изолированных контекста: списание средств у пользователей и начисление средств исполнителям.
Несмотря на то, что оба эти контекста находятся в одном поддомене, они описывают разные бизнес-процессы.
На самом деле здесь у меня больше интуитивное ощущение, что надо так сделать, объяснить пока не могу.

## Event Storming

Обновлённая диаграмма доступна по [ссылке](https://miro.com/app/board/uXjVLr3CjCk=/?moveToWidget=3458764614519969442&cot=14).

## Модель данных

Обновлённая структурная модель данных доступна по [ссылке](data-model/cdm.drawio.png).
Общая модель данных с учётом обмена данными между контекстами доступна по [этой ссылке](data-model/dm.drawio.png).

## Архитектурные характеристики

Для выбора важных архитектурных характеристик я обратился к общему тз.
Бизнесу необходим низкий ТТМ, значит выбираем *agility*, *testability* и *deployability*

Общая нагрузка пользователей ожидается низкая (10 заказов в день и 100 клиентов, 20 исполнителей).
При этом ожидается 1к заявок в день от кандидатов в исполнители, также есть угроза ddos атаки.
Из этих соображений выбираем *availability* и *scalability*.

Для бизнеса критично проверять новые гипотезы по отсеву котов и изменять уже существующие с максимальной скоростью и надёжностью.
Это значит, что важными характеристиками будут *agility*, *modifiability* и *reliability*.

Деньги не критичны, поэтому характеристику *cost* не будем считать критичной.

Примечание, в таблице по сравнению вариантов архитектуры не было *availability*, я взял *fault tolerance* как аналогичный по смыслу показатель.

Таблица с отмеченными характеристиками лежит [здесь](architecture-characteristics/architecture-characteristics.png).
Больше всего под заданные параметры подходит микросервисная архитектура.
На втором месте сервисы, но у этого варианта хуже *modifiability*.
Также у микросервисной архитектуры выше стоимость, но *cost* в данный момент не является критичной характеристикой, поэтому в качестве архитектурного стиля выбираем микросервисы.

## Итоговая модель системы

В системе есть поддомен исполнение заказов, который содержит 4 изолированных контекста.
Поскольку между этими контекстами довольно большой coupling, я принял решение оставить исполнение заказов в виде одного микросервиса.

Схему компонентов я доделать не успел :(
